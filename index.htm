<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>学校日誌（HTML）</title>
  <style>
    :root{
      --line:#111;
      --thin:1px;
      --thick:2px;
      --font: 12.5pt;
      --gap: 6mm;
    }

    /* 画面表示 */
    body{
      margin:0;
      background:#f2f2f2;
      font-family: system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Meiryo", sans-serif;
      color:#111;
    }
    .toolbar{
      position: sticky;
      top:0;
      z-index:10;
      background:#fff;
      border-bottom:1px solid #ddd;
      padding:10px 12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .toolbar .spacer{ flex:1; }
    .toolbar button{
      border:1px solid #ccc;
      background:#fff;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
    }
    .toolbar button:hover{ background:#f7f7f7; }
    .toolbar .hint{
      font-size:12px; color:#555;
      margin-left:6px;
    }

    /* A4用紙 */
    .page-wrap{
      padding:14px 0 30px;
      display:flex;
      justify-content:center;
    }
    .page{
      width: 210mm;
      min-height: 297mm;
      background:#fff;
      box-shadow: 0 8px 30px rgba(0,0,0,.15);
      padding: 10mm;
      box-sizing:border-box;
    }

    .frame{
      border: var(--thick) solid var(--line);
      height: 100%;
      min-height: calc(297mm - 20mm);
      padding: 8mm;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    /* 上部 */
    .top{
      display:grid;
      grid-template-columns: 1fr;
      gap: 4mm;
    }
    .title-row{
      display:grid;
      grid-template-columns: 38mm 1fr;
      align-items:end;
      gap: 6mm;
    }
    .title{
      font-size: 18pt;
      font-weight: 700;
      letter-spacing: .12em;
      padding-bottom: 2mm;
      border-bottom: var(--thick) solid var(--line);
    }
    .meta{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 3mm;
      font-size: var(--font);
    }
    .field{
      border: var(--thin) solid var(--line);
      padding: 2.2mm 2.5mm;
      display:flex;
      gap: 2mm;
      align-items:center;
      min-height: 10mm;
      box-sizing:border-box;
    }
    .field label{
      white-space:nowrap;
      font-size: 10.5pt;
    }
    .field input{
      width: 100%;
      border:none;
      outline:none;
      font-size: var(--font);
      background:transparent;
    }
    .field .small{
      width: 7ch;
    }

    /* 小枠（画像の「横線＋細かい区切り」っぽい部分） */
    .mini-grid{
      border: var(--thin) solid var(--line);
      display:grid;
      grid-template-columns: repeat(12, 1fr);
    }
    .mini-cell{
      border-left: var(--thin) solid var(--line);
      padding: 2mm 1.5mm;
      min-height: 12mm;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap: 1mm;
    }
    .mini-cell:first-child{ border-left:none; }
    .mini-label{
      font-size: 9pt;
      color:#222;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .mini-cell input{
      border:none;
      border-bottom: 1px solid #999;
      outline:none;
      font-size: 11.5pt;
      background:transparent;
      padding:1px 0;
    }

    /* 中央の大きい記入欄（罫線付き） */
    .main-note{
      flex: 1;
      border: var(--thin) solid var(--line);
      padding: 4mm;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap: 2mm;
      min-height: 160mm;
    }
    .section-title{
      font-weight:700;
      font-size: 12pt;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 8px;
    }
    textarea{
      width:100%;
      flex:1;
      resize:none;
      border:none;
      outline:none;
      font-size: var(--font);
      line-height: 1.6;
      padding: 2mm 1mm;
      box-sizing:border-box;
      background:
        repeating-linear-gradient(
          to bottom,
          transparent 0,
          transparent calc(1.6em - 1px),
          rgba(0,0,0,.25) calc(1.6em - 1px),
          rgba(0,0,0,.25) 1.6em
        );
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    /* 下部：押印欄＋左右2表 */
    .bottom{
      display:grid;
      grid-template-columns: 1fr;
      gap: 4mm;
    }
    .sign-row{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6mm;
    }
    .sign{
      border-top: var(--thin) solid var(--line);
      padding-top: 2mm;
    }
    .sign .line{
      height: 10mm;
      border-bottom: var(--thin) solid var(--line);
      margin-top: 2mm;
    }
    .sign .label{
      font-size:10.5pt;
      display:flex;
      justify-content:space-between;
      gap:6px;
    }
    .sign input{
      border:none;
      outline:none;
      background:transparent;
      width: 100%;
      font-size: 10.5pt;
      text-align:right;
    }

    .tables{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8mm;
    }
    table{
      border-collapse: collapse;
      width:100%;
      table-layout: fixed;
      font-size: 11.5pt;
    }
    th, td{
      border: var(--thin) solid var(--line);
      padding: 2mm;
      vertical-align: top;
    }
    th{
      font-weight:700;
      text-align:center;
      background:#fff;
    }
    td[contenteditable="true"]{
      outline: none;
      min-height: 10mm;
    }

    /* 印刷最適化 */
    @page { size: A4; margin: 8mm; }
    @media print{
      body{ background:#fff; }
      .toolbar, .page-wrap{ padding:0; }
      .toolbar{ display:none !important; }
      .page{
        box-shadow:none;
        width:auto;
        min-height:auto;
        padding:0;
      }
      .frame{
        min-height:auto;
      }
      textarea{
        background:
          repeating-linear-gradient(
            to bottom,
            transparent 0,
            transparent calc(1.6em - 1px),
            rgba(0,0,0,.35) calc(1.6em - 1px),
            rgba(0,0,0,.35) 1.6em
          );
      }
    }
  </style>
</head>

<body>
  <div class="toolbar">
    <button type="button" id="prevBtn">◀ 前日</button>
    <button type="button" id="todayBtn">今日</button>
    <button type="button" id="nextBtn">翌日 ▶</button>

    <span class="hint">日付：</span>
    <input type="date" id="datePicker" style="padding:6px 10px;border:1px solid #ccc;border-radius:8px;font-size:14px" />

    <div class="spacer"></div>

    <button type="button" id="saveBtn">保存</button>
    <button type="button" id="loadBtn">読み込み</button>
    <button type="button" id="clearBtn">クリア</button>
    <button type="button" id="printBtn">印刷</button>
    <span class="hint">※自動保存あり（この端末のブラウザ内）</span>
  </div>

  <div class="page-wrap">
    <div class="page">
      <div class="frame" id="sheet">
        <!-- 上部 -->
        <div class="top">
          <div class="title-row">
            <div class="title">学校日誌</div>

            <div class="meta">
              <div class="field">
                <label>年度</label>
                <input id="fy" placeholder="令和○年度" />
              </div>
              <div class="field">
                <label>日付</label>
                <input id="ymd" placeholder="YYYY/MM/DD" />
              </div>
              <div class="field">
                <label>曜日</label>
                <input id="dow" placeholder="（自動）" />
              </div>
              <div class="field">
                <label>天候</label>
                <input id="weather" placeholder="晴 / 曇 / 雨 など" />
              </div>

              <div class="field">
                <label>日直</label>
                <input id="nichoku" placeholder="氏名" />
              </div>
              <div class="field">
                <label>記録</label>
                <input id="recorder" placeholder="氏名" />
              </div>
              <div class="field">
                <label>学年</label>
                <input id="grade" placeholder="例：全校 / 1～6 / ○年" />
              </div>
              <div class="field">
                <label>備考</label>
                <input id="remarkTop" placeholder="短いメモ" />
              </div>
            </div>
          </div>

          <!-- 画像の「細かい区切り」風：数値やチェックを書ける小枠 -->
          <div class="mini-grid" aria-label="小枠（自由に使う）">
            <div class="mini-cell"><div class="mini-label">欠席</div><input data-mini="kesseki" /></div>
            <div class="mini-cell"><div class="mini-label">遅刻</div><input data-mini="chikoku" /></div>
            <div class="mini-cell"><div class="mini-label">早退</div><input data-mini="soutai" /></div>
            <div class="mini-cell"><div class="mini-label">出張</div><input data-mini="shutcho" /></div>
            <div class="mini-cell"><div class="mini-label">休暇</div><input data-mini="kyuka" /></div>
            <div class="mini-cell"><div class="mini-label">来客</div><input data-mini="raikyaku" /></div>
            <div class="mini-cell"><div class="mini-label">保護者</div><input data-mini="hogo" /></div>
            <div class="mini-cell"><div class="mini-label">事故/安全</div><input data-mini="anzen" /></div>
            <div class="mini-cell"><div class="mini-label">給食</div><input data-mini="kyushoku" /></div>
            <div class="mini-cell"><div class="mini-label">清掃</div><input data-mini="seiso" /></div>
            <div class="mini-cell"><div class="mini-label">行事</div><input data-mini="gyoji" /></div>
            <div class="mini-cell"><div class="mini-label">その他</div><input data-mini="other" /></div>
          </div>
        </div>

        <!-- 中央：記入欄 -->
        <div class="main-note">
          <div class="section-title">
            <span>記事（できごと・連絡事項・特記事項 など）</span>
            <span style="font-weight:400;font-size:10.5pt;color:#555;">※ここは罫線つき</span>
          </div>
          <textarea id="note" placeholder="例）
・朝：〇〇の確認、来客対応
・2校時：〇年〇組 研究授業
・安全：〇〇注意喚起
・放課後：職員打合せ（内容） など"></textarea>
        </div>

        <!-- 下部 -->
        <div class="bottom">
          <!-- 押印/確認欄（名称は自由に書き換えOK） -->
          <div class="sign-row">
            <div class="sign">
              <div class="label"><span>校長</span><input placeholder="確認" /></div>
              <div class="line"></div>
            </div>
            <div class="sign">
              <div class="label"><span>教頭</span><input placeholder="確認" /></div>
              <div class="line"></div>
            </div>
            <div class="sign">
              <div class="label"><span>教務</span><input placeholder="確認" /></div>
              <div class="line"></div>
            </div>
            <div class="sign">
              <div class="label"><span>日直</span><input placeholder="確認" /></div>
              <div class="line"></div>
            </div>
          </div>

          <!-- 左右の表（セルをクリックして入力） -->
          <div class="tables">
            <table aria-label="左表">
              <thead>
                <tr><th colspan="4">学年・出欠等（例）</th></tr>
                <tr>
                  <th style="width:18%;">学年</th>
                  <th style="width:20%;">欠席</th>
                  <th style="width:20%;">遅刻/早退</th>
                  <th>備考</th>
                </tr>
              </thead>
              <tbody>
                <tr><td contenteditable="true">1</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true">2</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true">3</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true">4</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true">5</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true">6</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
              </tbody>
            </table>

            <table aria-label="右表">
              <thead>
                <tr><th colspan="4">教職員・出張等（例）</th></tr>
                <tr>
                  <th style="width:28%;">氏名</th>
                  <th style="width:22%;">区分</th>
                  <th style="width:22%;">時間</th>
                  <th>備考</th>
                </tr>
              </thead>
              <tbody>
                <tr><td contenteditable="true"></td><td contenteditable="true">出張</td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true">休暇</td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true">研修</td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true">来客対応</td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
              </tbody>
            </table>
          </div>
        </div>

      </div><!-- frame -->
    </div><!-- page -->
  </div><!-- wrap -->

  <script>
    const $ = (id)=>document.getElementById(id);

    const fields = [
      "fy","ymd","dow","weather","nichoku","recorder","grade","remarkTop","note"
    ];

    function pad(n){ return String(n).padStart(2,"0"); }
    function toKey(dateStr){ return "school_log_" + dateStr; }

    function formatYMD(d){
      return `${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())}`;
    }
    function dowJa(d){
      const w = ["日","月","火","水","木","金","土"][d.getDay()];
      return `${w}曜`;
    }
    function dateToISO(d){
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }
    function isoToDate(iso){
      const [y,m,da]=iso.split("-").map(Number);
      return new Date(y,m-1,da);
    }

    function setDate(iso){
      $("datePicker").value = iso;
      const d = isoToDate(iso);
      $("ymd").value = formatYMD(d);
      $("dow").value = dowJa(d);
      autoLoad(); // 日付を変えたら自動で読み込み
    }

    function snapshot(){
      const data = {};
      fields.forEach(id=> data[id] = $(id).value);

      // mini
      document.querySelectorAll("[data-mini]").forEach(inp=>{
        data["mini_"+inp.dataset.mini] = inp.value;
      });

      // tables (contenteditable)
      const tds = Array.from(document.querySelectorAll("td[contenteditable='true']"));
      data["cells"] = tds.map(td=>td.innerText);
      return data;
    }

    function restore(data){
      if(!data) return;
      fields.forEach(id=>{
        if(id in data) $(id).value = data[id];
      });

      document.querySelectorAll("[data-mini]").forEach(inp=>{
        const k = "mini_"+inp.dataset.mini;
        inp.value = data[k] ?? "";
      });

      const tds = Array.from(document.querySelectorAll("td[contenteditable='true']"));
      if(Array.isArray(data.cells)){
        tds.forEach((td,i)=> td.innerText = data.cells[i] ?? "");
      }
    }

    function save(){
      const iso = $("datePicker").value || dateToISO(new Date());
      localStorage.setItem(toKey(iso), JSON.stringify(snapshot()));
    }

    function load(){
      const iso = $("datePicker").value || dateToISO(new Date());
      const raw = localStorage.getItem(toKey(iso));
      if(!raw) return false;
      try{
        restore(JSON.parse(raw));
        return true;
      }catch(e){
        return false;
      }
    }

    function clearAll(){
      if(!confirm("この日の入力を消します（保存データも削除）。よろしいですか？")) return;
      // 画面クリア
      fields.forEach(id=> $(id).value = "");
      document.querySelectorAll("[data-mini]").forEach(inp=> inp.value="");
      document.querySelectorAll("td[contenteditable='true']").forEach(td=> td.innerText="");
      // 保存削除
      const iso = $("datePicker").value || dateToISO(new Date());
      localStorage.removeItem(toKey(iso));
      // 日付系は復元
      const d = isoToDate(iso);
      $("ymd").value = formatYMD(d);
      $("dow").value = dowJa(d);
      $("fy").value = $("fy").value || "";
    }

    function autoLoad(){
      // 保存がなければ、日付系だけセット
      const iso = $("datePicker").value || dateToISO(new Date());
      const d = isoToDate(iso);
      $("ymd").value = formatYMD(d);
      $("dow").value = dowJa(d);

      // 既存があれば復元
      load();
    }

    // 自動保存（入力のたび）
    function bindAutosave(){
      const handler = ()=>{ save(); };
      fields.forEach(id=> $(id).addEventListener("input", handler));
      document.querySelectorAll("[data-mini]").forEach(inp=> inp.addEventListener("input", handler));
      document.querySelectorAll("td[contenteditable='true']").forEach(td=>{
        td.addEventListener("input", handler);
      });
    }

    // ナビゲーション
    function shiftDay(delta){
      const iso = $("datePicker").value || dateToISO(new Date());
      const d = isoToDate(iso);
      d.setDate(d.getDate()+delta);
      setDate(dateToISO(d));
    }

    // 初期化
    (function init(){
      const todayIso = dateToISO(new Date());
      setDate(todayIso);
      bindAutosave();

      $("todayBtn").onclick = ()=> setDate(todayIso);
      $("prevBtn").onclick = ()=> shiftDay(-1);
      $("nextBtn").onclick = ()=> shiftDay(1);

      $("saveBtn").onclick = ()=>{ save(); alert("保存しました（この端末のブラウザ内）"); };
      $("loadBtn").onclick = ()=>{ if(!load()) alert("この日付の保存データはありません"); };
      $("clearBtn").onclick = clearAll;
      $("printBtn").onclick = ()=> window.print();

      $("datePicker").addEventListener("change", (e)=> setDate(e.target.value));

      // 年度（例）を薄く初期提案：4/1基準
      const d = new Date();
      const fy = (d.getMonth()+1 >= 4) ? d.getFullYear() : (d.getFullYear()-1);
      $("fy").placeholder = `令和${fy-2018}年度（例）`; // 令和1=2019
    })();
  </script>
</body>
</html>